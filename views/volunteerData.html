<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Data Table</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        button {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1 id="pageTitle">Volunteer Details</h1>
    <table id="dataTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>
    <button id="printButton">Print</button>

    <!-- Include jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Include jsPDF AutoTable Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.26/jspdf.plugin.autotable.min.js"></script>

    <script>
        const { jsPDF } = window.jspdf;

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/Vol');
                const data = await response.json();
                generateTable('Volunteer Data', ['Name', 'Email', 'Stater', 'Pincode', 'Volunteering Steps'], 
                    data.map(user => [user.name, user.email, user.state, user.pincode, user.steps]));
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        });

        document.getElementById('printButton').addEventListener('click', () => {
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(18);
            doc.text(document.getElementById('pageTitle').textContent, 10, 10);
            
            // Get table data
            const headers = ['Name', 'Email', 'State', 'Pincode', 'Volunteering Steps'];
            const rows = Array.from(document.querySelectorAll('#dataTable tr')).slice(1).map(tr => 
                Array.from(tr.querySelectorAll('td')).map(td => td.textContent)
            );

            // Add table to PDF
            doc.autoTable({
                head: [headers],
                body: rows,
                startY: 20, // Adjust position
            });

            // Save the PDF
            doc.save('vol.pdf');
        });

        function generateTable(title, headers, rows) {
            document.getElementById('pageTitle').textContent = title;
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            thead.innerHTML = '';
            tbody.innerHTML = '';

            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            rows.forEach(rowData => {
                const row = document.createElement('tr');
                rowData.forEach(cellData => {
                    const td = document.createElement('td');
                    td.textContent = cellData;
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
